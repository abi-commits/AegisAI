
S3_AUDIT_BUCKET=aegis-audit-logs

# Prefix for audit logs within the bucket (default: audit-logs/)
# Logs will be stored at: s3://{BUCKET}/{PREFIX}/{ENVIRONMENT}/{DATE}/audit.jsonl
S3_AUDIT_PREFIX=audit-logs/

S3_ENVIRONMENT=production
S3_ENABLE_VERSIONING=true

# Enable S3 Object Lock for governance/compliance mode
# When enabled, objects cannot be deleted or modified for a specified retention period
# Requires bucket to be created with Object Lock enabled
S3_ENABLE_OBJECT_LOCK=false

# ============================================================================
# DynamoDB Operational Metadata Configuration
# ============================================================================

# DynamoDB table for fast operational metadata lookups
# Table must be created in advance with appropriate schema and GSIs
DYNAMODB_METADATA_TABLE=aegis-operational-metadata

# Enable TTL for automatic cleanup of old metadata records
# Records older than DYNAMODB_TTL_DAYS will be auto-deleted
DYNAMODB_ENABLE_TTL=true

# Number of days to retain metadata before auto-cleanup
DYNAMODB_TTL_DAYS=90

# ============================================================================
# AWS Configuration
# ============================================================================

# AWS region for S3 and DynamoDB
AWS_REGION=us-east-1

# AWS profile name (optional)
# If set, uses credentials from ~/.aws/credentials [AWS_PROFILE]
# If not set, uses default AWS credential chain (IAM role, env vars, etc.)
# AWS_PROFILE=aegis-production

# ============================================================================
# Audit Store Backend Selection
# ============================================================================

# Storage backend: "s3" (default), "file", or "dynamodb"
# - "s3": Use S3 for immutable append-only logs (RECOMMENDED FOR PRODUCTION)
# - "file": Use local file system (useful for development/testing)
# - "dynamodb": Use DynamoDB (not recommended for primary audit logs)
AUDIT_STORAGE_TYPE=s3

# ============================================================================
# Hash Chain Integrity Configuration
# ============================================================================

# Enable hash chain for tamper detection
# When enabled, each entry includes hash of previous entry (cryptographic proof of ordering)
ENABLE_HASH_CHAIN=true

# Hash algorithm for integrity checks: sha256 (default), sha512, blake2b, etc.
HASH_ALGORITHM=sha256

# ============================================================================
# Performance Configuration
# ============================================================================

# Use background writer for async audit logging
# When enabled, writes happen in background thread (lower latency)
# When disabled, writes are synchronous (guaranteed durability)
USE_BACKGROUND_WRITER=false

# ============================================================================
# Local File Store (for development/testing)
# ============================================================================

# Directory for local audit logs (only used if AUDIT_STORAGE_TYPE=file)
AUDIT_LOG_DIR=./logs/audit

# ============================================================================
# Example AWS CLI Setup
# ============================================================================
# 
# 1. Create S3 bucket with versioning:
#    aws s3api create-bucket --bucket aegis-audit-logs --region us-east-1
#    aws s3api put-bucket-versioning --bucket aegis-audit-logs \
#      --versioning-configuration Status=Enabled
#
# 2. Create DynamoDB table:
#    aws dynamodb create-table \
#      --table-name aegis-operational-metadata \
#      --attribute-definitions \
#        AttributeName=pk,AttributeType=S \
#        AttributeName=sk,AttributeType=S \
#      --key-schema \
#        AttributeName=pk,KeyType=HASH \
#        AttributeName=sk,KeyType=RANGE \
#      --billing-mode PAY_PER_REQUEST \
#      --global-secondary-indexes \
#        IndexName=gsi1_pk-gsi1_sk-index,\
#Keys=[{AttributeName=gsi1_pk,KeyType=HASH},{AttributeName=gsi1_sk,KeyType=RANGE}],\
#Projection={ProjectionType=ALL},\
#        IndexName=gsi2_pk-gsi2_sk-index,\
#Keys=[{AttributeName=gsi2_pk,KeyType=HASH},{AttributeName=gsi2_sk,KeyType=RANGE}],\
#Projection={ProjectionType=ALL} \
#      --region us-east-1
#
#    Enable TTL on ttl_timestamp attribute:
#    aws dynamodb update-time-to-live --table-name aegis-operational-metadata \
#      --time-to-live-specification AttributeName=ttl_timestamp,Enabled=true \
#      --region us-east-1
#
# 3. Set IAM permissions:
#    - S3: s3:GetObject, s3:PutObject, s3:GetBucketVersioning, s3:ListBucket
#    - DynamoDB: dynamodb:PutItem, dynamodb:GetItem, dynamodb:Query, 
#                dynamodb:UpdateItem
#
